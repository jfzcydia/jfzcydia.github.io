<!DOCTYPE html>
<html lang="zh-CN">
<head>
   <meta charset="utf-8">
   <title>插件详情页</title>
   <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=0">

   <!-- 设置网页图标 -->
   <link rel="shortcut icon" href="../img/favicon.png">
   <link rel="apple-touch-icon" href="../img/favicon.png">

   <!-- 导入iOS7 CSS样式 -->
   <link rel="stylesheet" href="../my-css-ios7/ios7.min.css">
   <!-- <script src="my-css-ios7/ios7.min.js"></script> -->

   <script type="text/javascript" src="../my-js/jquery.min.js"></script>

   <script type="text/javascript" src="../my-js/jquery.querystring.js"></script>
   <script type="text/javascript" src="../my-js/data-loader-engine.js"></script>
   <script type="text/javascript" src="../my-js/ios_version_check.js"></script>
   
   <script type="text/javascript">

      bundleid = $.QueryString['p'];

      var contentBlocks =    {
         "#packageName" :
            {"type":"text","source":"package>name"}
         ,"#packageHeader" :
            {"type":"custom"
               ,"source":"package>name"
               ,"render":function(element,source){
                  if (navigator.userAgent.search(/Cydia/) == -1) {
                     $(element).show();
                  }
               }
            }
         ,"#packageVersion" :
            {"type":"text","source":"package>version"}
         ,"#packageShortDesc" : 
            {"type":"text","source":"package>shortDescription"}
         ,"#compatibilityCheck" :
            {"type":"custom"
               ,"source":"package>compatibility>firmware"
               ,"render":function(element,source){
                  var res = ios_version_check(
                     $(source).find("miniOS").text(),
                     $(source).find("maxiOS").text(),
                     $(source).find("otherVersions").text(),
                     function(message,isBad) {
                        $(element).html(message)
                        .addClass( (isBad?'alert-danger':'alert-success'));
                     }
                  );
                  if(res==0) {$(element).hide()}
               }
            }
            ,"#descriptionList"   :
            {"type":"list"
               ,"source" :"package>descriptionlist>description"
               ,"paragraphElement"  : "<p>"
               ,"emptyListCallback":function(e){$("#descriptionPanel").hide()}
            }
            ,"#screenshotsLink"   :
            {"type":"custom"
               ,"source" :"package>screenshots>screenshot"
               ,"render":function(element, source){
                  $("#screenshotsLink").remove();
                  if ($(source).size() == 0) {
                     return
                  }
                  // 创建屏幕截图链接
                  $("#descriptionList").append(
                     $("<li><a role='button'>")
                        .attr("href","screenshots.html?p="+bundleid)
                        .text("屏幕截图")
                  );
               }
            }
         ,"#versionBadge" : {"type":"text","source":"package>version"}
            ,"#changesList" :
            {"type":"list"
               ,"source" :"package>changelog>change"
               ,"reverseRender"    : true
               ,"paragraphElement"  : "<li class='list-group-item'>"
               ,"emptyListCallback":function(e){$("#changesList").hide()}
            }
         ,"#changelogLink" :
               {"type":"custom"
                     ,"source" :"package>changelog>change"
                     ,"render":function(element, source){
                        $("#changelogLink").remove();
                        if ($(source).size() == 0) {
                           return
                        }
                        // 创建更新记录链接
                        $("#changesList").append(
                           $("<a class='link-item list-group-item'>")
                               .attr("href","changelog.html?p="+bundleid)
                               .text("历史记录")
                       );
                   }
               }
         ,"#dependencyList" :
            {"type":"list"
               ,"source" :"package>dependencies>package"
               ,"paragraphElement"  : "<li class='list-group-item'>"
               ,"emptyListCallback":function(e){$("#dependenciesContainer").remove()}
            }
         ,"#externalLinksList" :
            {"type":"custom"
               ,"source" :"package>links>link"
               ,"paragraphElement"  : "<li class='list-group-item'>"
               ,"render":function(element,source){
                  if ($(source).size()==0){
                     $('#externalLinksContainer').remove()
                  }

                       $.each(source, function(index,data) {
                           var a = $("<a class='link-item list-group-item'>");
                           a.attr("href",$(data).find('url').text());
                           if ($(data).find('iconclass')) {
                               var i =  $("<span>")
                               i.attr("class",$(data).find('iconclass').text());
                               console.log(i);
                               $(a).append(i);
                           }
                           $(a).append($(data).find('name').text());
                           $(element).append(a);
                       }); //each

               }

            }
      }
      $( document ).ready(function() {
           $.ajax({
               type    : "GET",
               dataType: "xml",
               url     : (bundleid+"/info.xml"),
               success : function(xml){
               document.title = $(xml).find("package>name").text();
                  data_loader_engine(contentBlocks,xml)

               },
            cache   : false,
               error: function() {
                   $("#packageError").show();
               $("#packageInformation").hide();
               }
            }); //ajax
      }); // ready
  </script>

</head>
<body>
   <header>
      <h1 id="packageName">wifi</h1>
   </header>

<!-- 简短描述 -->
<p id="packageShortDesc" style="text-align: center;"><strong>简短描述</strong></p>


<!-- 兼容性适配 -->
<ul>
   <li id="compatibilityCheck">兼容适配</li>
</ul>


   <main id="content">
      <h2 role="header">简介</h2>
      <ul>
         <li id="descriptionList"></li>
         <li id="screenshotsLink" />
      </ul>

      <h2 role="header">更新 <span id="versionBadge" style="color: red;" /></h2>
      <ul id="changesList">
         <li id="changelogLink">
            <a href="#" target="_blank" role="button"></a>
         </li>
      </ul>

      <h2 role="header">链接</h2>
      <ul>
         <li>
            <p><a href="">开发者主页</a></p>
         </li>
      </ul>



<!--  -->
      <h2 role="header">联系方式</h2>      
      <ul>
         <li>
            <p><a href="">Github</a></p>
            <p><a href="">Twitter</a></p>
            <p><a href="">新浪微博</a></p>
         </li>
      </ul>

      <p role="footer">&copy 2019 见风致</p>
   </main>
</body>
</html>